<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-database.js"></script>
    <style>
        .container {
            margin-top: 20px;
        }
        .form-box {
            padding: 20px;
            border: 1px solid #000;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .form-title {
            margin-bottom: 10px;
        }
        .category-list {
            margin-top: 10px;
        }
        .category-list ul {
            list-style-type: none;
            padding-left: 0;
        }
        .category-list li {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        .divider {
            border-left: 2px solid black;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <!-- Add Category Section -->
            <div class="col-md-4">
                <div class="form-box">
                    <button type="button" class="btn btn-outline-dark w-100 mb-2">Add Category</button>
                    <div class="form-title"><strong>Add new Category</strong></div>
                    <div>
                        <div class="mb-3">
                            <label for="categoryName" class="form-label">Category Name:</label>
                            <input type="text" class="form-control" id="categoryName" placeholder="Enter category name">
                        </div>
                        <button type="button" class="btn btn-dark w-100" onclick='whutmo()'>Save</button>
                    </div>
                </div>

                <!-- View Category Section -->
                <div class="form-box category-list">
                    <button type="button" class="btn btn-outline-dark w-100 mb-2">View Category</button>
                    <ul id="catnames">
                        <!-- Dynamic Category List -->
                    </ul>
                </div>
            </div>

            <div class="col-md-1 d-none d-md-block">
                <div class="divider"></div>
            </div>

            <!-- Add News Section -->
            <div class="col-md-7">
                <div class="form-box">
                    <button type="button" class="btn btn-outline-dark w-100 mb-2">Add News</button>
                    <form id="newsForm">
                        <div class="mb-3">
                            <label for="headline" class="form-label">Headline:</label>
                            <input type="text" class="form-control" id="headline" placeholder="Enter headline">
                        </div>
                        <div class="mb-3">
                            <label for="subHeadline" class="form-label">Sub Headline:</label>
                            <input type="text" class="form-control" id="subHeadline" placeholder="Enter sub headline">
                        </div>
                        <div class="mb-3">
                            <label for="newsDetails" class="form-label">News Details:</label>
                            <textarea class="form-control" id="newsDetails" rows="5" placeholder="Enter news details"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="image" class="form-label">Image:</label>
                            <input type="file" class="form-control" id="image" onchange="handleImageUpload()">
                            <input type="hidden" id="imageSource">
                        </div>
                        <div class="mb-3">
                            <label for="source" class="form-label">Source:</label>
                            <input type="text" class="form-control" id="source" placeholder="Enter source">
                        </div>
                        <div class="mb-3">
                            <label for="source" class="form-label">Category:</label>
                            <input type="text" class="form-control" id="categ" placeholder="Enter category">
                        </div>
                        <div class="mb-3">
                            <label for="newsCategory" class="form-label">News Category:</label>
                            <select class="form-select" id="newsCategory"></select>>
                                <option selected>Select Category</option>
                                <!-- Dynamic Categories Options -->
                            </select>
                        </div>
                        <button type="button" class="btn btn-dark" onclick="saveNews()">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyDhZPE8mascQUpraZYrDWKMYa2a0cp7LFw",
            authDomain: "yolopanel.firebaseapp.com",
            databaseURL: "https://yolopanel-default-rtdb.firebaseio.com",
            projectId: "yolopanel",
            storageBucket: "yolopanel.appspot.com",
            messagingSenderId: "647674058442",
            appId: "1:647674058442:web:ca6822cfcbda29b2aac633"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        function whutmo() {
            var cat = document.getElementById("categoryName").value;
            database.ref("categories").push().set({
                "cat": cat
            });
        }

        function handleImageUpload() {
            var fileInput = document.getElementById("image");
            var file = fileInput.files[0];
            var reader = new FileReader();

            reader.onloadend = function () {
                var imageSource = reader.result;
                document.getElementById("imageSource").value = imageSource;
            };

            if (file) {
                reader.readAsDataURL(file);
            }
        }

        function saveNews() {
            var headline = document.getElementById("headline").value;
            var subHeadline = document.getElementById("subHeadline").value;
            var newsDetails = document.getElementById("newsDetails").value;
            var imageSource = document.getElementById("imageSource").value;
            var source = document.getElementById("source").value;
            var categ = document.getElementById("categ").value;
            var newsCategory = document.getElementById("newsCategory").value;

            database.ref("news").push().set({
                "headline": headline,
                "subHeadline": subHeadline,
                "details": newsDetails,
                "image": imageSource,
                "source": source,
                "category": newsCategory,
                "categ":categ
            });
            alert('news added')
            var headline = document.getElementById("headline").value;
            var subHeadline = document.getElementById("subHeadline").value;
            var newsDetails = document.getElementById("newsDetails").value;
            var imageSource = document.getElementById("imageSource").value;
            var source = document.getElementById("source").value;
            var newsCategory = document.getElementById("newsCategory").value;
        }


        function renderCategory(id, category) {
            return `
                <li id="category-${id}">
                    <span class="category-text">${category}</span>
                    <input type="text" class="form-control category-edit d-none" value="${category}">
                    <button type="button" class="btn btn-sm btn-outline-dark" onclick="editCategory('${id}')">edit</button>
                    <button type="button" class="btn btn-sm btn-dark d-none" onclick="saveEdit('${id}')">save</button>
                </li>
            `;
        }

        function editCategory(id) {
            document.querySelector(`#category-${id} .category-text`).classList.add('d-none');
            document.querySelector(`#category-${id} .category-edit`).classList.remove('d-none');
            document.querySelector(`#category-${id} .btn-outline-dark`).classList.add('d-none');
            document.querySelector(`#category-${id} .btn-dark`).classList.remove('d-none');
        }

        function saveEdit(id) {
            var newCategoryName = document.querySelector(`#category-${id} .category-edit`).value;
            saveCategory(id, newCategoryName);

            // Update the list and dropdown
            var categoryItem = document.querySelector(`#category-${id}`);
            categoryItem.innerHTML = renderCategory(id, newCategoryName);
        }

        function saveCategory(id, newCategoryName) {
            database.ref("categories/" + id).update({
                "cat": newCategoryName
            });
        }

        // Fetch categories and update both the list and dropdown
        database.ref("categories").on("child_added", function(snapshot) {
            var id = snapshot.key;
            var category = snapshot.val().cat;

            // Update Category List
            var cate = document.getElementById("catnames");
            cate.innerHTML = renderCategory(id, category) + cate.innerHTML;

            // Update News Category Dropdown
            var dropdownOption = `
                <option value="${id}">${category}</option>
            `;
            var newsCategoryDropdown = document.getElementById("newsCategory");
            newsCategoryDropdown.innerHTML = newsCategoryDropdown.innerHTML + dropdownOption;
        });
       
    </script>
</body>
</html>
